package authjwt

import (
	"github.com/stretchr/testify/assert"
	"testing"
)

const (
	tokenStrLocal = "eyJhbGciOiJSUzI1NiIsImtpZCI6IjQ5YWQ5YmM1ZThlNDQ3OTNhMjEwOWI1NmUzNjFhMjNiNDE4ODA4NzUiLCJ0eXAiOiJKV1QifQ.eyJwaWN0dXJlIjoiaHR0cHM6Ly9zdG9yYWdlLmdvb2dsZWFwaXMuY29tL3Bva2VyYmxvdy1hdmF0YXJzLzJmUjVNWXlqcU1TTWd6THRka2RyS1prYzE4dDEiLCJ1c2VybmFtZSI6ImRlbmlzIiwiaXNzIjoiaHR0cHM6Ly9zZWN1cmV0b2tlbi5nb29nbGUuY29tL3Bva2VyYmxvdyIsImF1ZCI6InBva2VyYmxvdyIsImF1dGhfdGltZSI6MTU5OTE0NDc1OCwidXNlcl9pZCI6IjJmUjVNWXlqcU1TTWd6THRka2RyS1prYzE4dDEiLCJzdWIiOiIyZlI1TVl5anFNU01nekx0ZGtkcktaa2MxOHQxIiwiaWF0IjoxNTk5ODI0OTY2LCJleHAiOjE1OTk4Mjg1NjYsImVtYWlsIjoiZGVuaXNnbG90b3Y5OEBtYWlsLnJ1IiwiZW1haWxfdmVyaWZpZWQiOmZhbHNlLCJmaXJlYmFzZSI6eyJpZGVudGl0aWVzIjp7ImVtYWlsIjpbImRlbmlzZ2xvdG92OThAbWFpbC5ydSJdfSwic2lnbl9pbl9wcm92aWRlciI6InBhc3N3b3JkIn19.uUFnfxWFGXAlPFjS9Lf5QjB_YLx824dqDjnOQi-xYquaCRjE9yMHZ-Tk8MKLhbjjWWWK0eleghfqIbZQmTowXhOkq9h5fCb5RgWUrRe2otRm5APhWrX-xXkkDpl5uEcYj9xly-1MHrCUBQdUCFaQdkwD960LJf-8saFmv_FWND-QveRyJxja10Dt8L6I6YI_NjoZTgYe24JamNNgxkFrfqFNN6fPN_X_SQYJXHetkX0zm_SL6UODwgId6ioTSOM0QrLt1ZcdGiq1eNuX8s9aQqHs8XYPRm4Bt0zARX3J4RReX9OZa64O9d26WDnLVz_QdPzzIz8itxpiZnYIjnGVRA"
	tokenStrAnonymous = "eyJhbGciOiJSUzI1NiIsImtpZCI6IjhmNDMyMDRhMTc5MTVlOGJlN2NjZDdjYjI2NGRmNmVhMzgzYzQ5YWIiLCJ0eXAiOiJKV1QifQ.eyJwcm92aWRlcl9pZCI6ImFub255bW91cyIsImlzcyI6Imh0dHBzOi8vc2VjdXJldG9rZW4uZ29vZ2xlLmNvbS9wb2tlcmJsb3ciLCJhdWQiOiJwb2tlcmJsb3ciLCJhdXRoX3RpbWUiOjE2MjU3Njg5MzcsInVzZXJfaWQiOiJGRjFnZklDNHNqUnZTSnpBampOVlg2YjJRcHYxIiwic3ViIjoiRkYxZ2ZJQzRzalJ2U0p6QWpqTlZYNmIyUXB2MSIsImlhdCI6MTYyNTc2ODkzNywiZXhwIjoxNjI1NzcyNTM3LCJmaXJlYmFzZSI6eyJpZGVudGl0aWVzIjp7fSwic2lnbl9pbl9wcm92aWRlciI6ImFub255bW91cyJ9fQ.EKxg1kVa5HmjGLsLeAHvDNvOFn8jJ8FwfMyLU_Y8K3Jimh5sIwh7Pmy0oN1ZPo2kWe9AawxbZ6jhFv_iaS3klg2B2wE9A8gwZ2CH1dC3ITq4VHP8pp0dZy-q5E7oDkOWikqz6OaeHNRiAShSC4jvZNjAX0R0y6ukWbWvty2V-hnC1Ryr9e2Xfz1IgZPmu2TVUAHH2DTSONTPyCHGPXF8vNSPupJ-0f3CoHSUo_hvnuvNE7Ec_vtZrsKHuF6uypEcnkv9NgvQa_TQM_b0q3DOqXFWP4KmNyVS_gV5aWbun_iYDVPgL3VmqFq1LiEf6i3gohukP5iz6GHUiFxZU4NFgw"
)

func TestVerifyTokenLocal(t *testing.T) {
	id, err := VerifyTokenLocalFull(tokenStrLocal)
	assert.Nil(t, err)

	assert.Equal(t, "denis", id.Username)
	assert.Equal(t, "2fR5MYyjqMSMgzLtdkdrKZkc18t1", id.UserId)
	assert.Equal(t, "https://storage.googleapis.com/pokerblow-avatars/2fR5MYyjqMSMgzLtdkdrKZkc18t1", id.Picture)
}

func TestVerifyAnonymousTokenLocal(t *testing.T) {
	id, err := VerifyTokenLocalFull(tokenStrAnonymous)
	assert.Nil(t, err)

	assert.Equal(t, "", id.Username)
	assert.Equal(t, "FF1gfIC4sjRvSJzAjjNVX6b2Qpv1", id.UserId)
	assert.Equal(t, "", id.Picture)
	assert.True(t, id.IsAnonymous())
	assert.False(t, id.EmailVerified)
}

